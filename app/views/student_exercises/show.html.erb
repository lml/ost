<%# Copyright 2011-2012 Rice University. Licensed under the Affero General Public 
    License version 3 or later.  See the COPYRIGHT file for details. %>

<%= render :partial => "header_info", :locals => { :student_exercise => @student_exercise } %>

<%= render :partial => "question", :locals => { :student_exercise => @student_exercise } %>

<% if @student_exercise.present_free_response_and_selected_answer? %>

  <%= section "Free Response", {:classes => ''} do %>
    <% if @student_exercise.free_response_submitted? %>
      <%= render :partial => "show_free_response", :locals => { :student_exercise => @student_exercise } %>
    <% else %>
      <%= render :partial => "input_free_response", :locals => { :student_exercise => @student_exercise } %>
    <% end %>
  <% end %>

  <% if @student_exercise.free_response_submitted? %>
    <%= section "Answer Verification", {:classes => 'no_bar'} do %>
      <% if @student_exercise.selected_answer_submitted? %>
        <%= render :partial => "show_selected_answer", :locals => { :student_exercise => @student_exercise } %>
      <% else %>
        <%= render :partial => "verify_free_response", :locals => { :student_exercise => @student_exercise } %>
      <% end %>
    <% end %>
  <% end %>

<% elsif @student_exercise.present_selected_answer_only? %>

  <%= section "Multiple Choice", {:classes => ''} do %>
    <% if @student_exercise.selected_answer_submitted? %>
      <%= render :partial => "show_selected_answer", :locals => { :student_exercise => @student_exercise } %>
    <% else %>
      <%= render :partial => "input_selected_answer", :locals => { :student_exercise => @student_exercise } %>
    <% end %>  
  <% end %>

<% else %>
  <% raise IllegalState, "The current StudentExercise presentation settings are not supported by this view" %>
<% end %>

<%= render :partial => 'shared/response_times', :locals => { :response_timeable => @student_exercise,
                                                             :page              => "work" } %>

<% content_for :javascript do %>
  <%= javascript_tag do %>
    function preview_response() {
      $.get('<%= student_exercise_preview_free_response_path(@student_exercise) %>', 
            $('form.edit_student_exercise').serializeArray());
    }
  <% end %>
<% end %>

<%= protect_form %>

<% navitem{ link_to 'Show Assignment', assignment_path(@student_exercise.assignment_exercise.assignment) }%>

<% content_for :other_nav_content do %>
  Exercises
  <%= render :partial => 'student_exercises/list', :locals => { :student_exercise => @student_exercise } %>
<% end %>
